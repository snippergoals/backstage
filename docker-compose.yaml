#!/usr/bin/env docker-compose -f

version: "3.4"

services:
  proxy:
    container_name: boss-proxy
    build:
      context: backend/proxy
    restart: unless-stopped
    ports:
      - "8080:80"

  identity:
    container_name: boss-identity
    build:
      context: backend
      args:
        service: identity
    restart: unless-stopped
    volumes:
       - ./backend/identity/identity-data.json:/app/identity-data.json

  inventory:
    container_name: boss-inventory
    build:
      context: backend
      args:
        service: inventory
    restart: unless-stopped

  builds:
    container_name: boss-builds
    build:
      context: backend
      args:
        service: builds
    restart: unless-stopped
    env_file: secrets.env

  scaffolder:
    depends_on:
      - inventory
    links:
      - inventory
    build:
      context: backend
      args:
        service: scaffolder
        base_image: scaffolder
    restart: unless-stopped
    volumes:
      - ./backend/scaffolder/templates:/app/templates:ro

    env_file: secrets.env
